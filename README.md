# –î–µ–ø–ª–æ–∏–º —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ üèÜ

–î–∞–Ω–æ:
1. –î–æ–º–µ–Ω
2. –ö—É–ø–ª–µ–Ω–Ω—ã–π —Å–µ—Ä–≤–∞–∫/–≤–∏–Ω—Ç—É–∞–ª–∫–∞ (amazon, vscale, digitalocean)

–ü–µ—Ä–≤—ã–º –¥–µ–ª–æ–º –Ω–∞—Å—Ç—Ä–æ–∏–º —Å–±–æ—Ä–∫—É —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞ —á–µ—Ä–µ–∑ travis-ci –∏ –µ–≥–æ –¥–æ—Å—Ç–∞–≤–∫—É –Ω–∞ —Å–µ—Ä–≤–µ—Ä.
–î–ª—è —Å–±–æ—Ä–∫–∏ —Å–æ–æ—Ä—É–¥–∏–º –ø—Ä–æ—Å—Ç–µ–Ω—å–∫–∏–π  .travis-ci.yml —Ñ–∞–π–ª–∏–∫:

```
language: node_js
node_js:
- '8'
script:
- npm run build
```

–ê —Ç–µ–ø–µ—Ä—å –Ω–µ–º–Ω–æ–≥–æ —É—Å–ª–æ–∂–Ω–∏–º –∏ –Ω–∞—Å—Ç—Ä–æ–∏–º –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–±—Ä–∞–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤ –Ω–∞ —Å–µ—Ä–≤–µ—Ä. –î–ª—è —ç—Ç–æ–≥–æ –Ω–∞–¥–æ –∫–∞–∫-—Ç–æ –ø–æ–º–µ—Å—Ç–∏—Ç—å –≤ —Ç—Ä–µ–≤–∏—Å –Ω–∞—à –ø—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–ª—é—á.
–≠—Ç–æ –º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –∫–æ–º–∞–Ω–¥–æ–π `travis encrypt-file ~/.ssh/technopark --add`

–¢—Ä–µ–≤–∏—Å –∑–∞—à–∏—Ñ—Ä—É–µ—Ç —Ñ–∞–π–ª –∏ –ø–æ–ª–æ–∂–∏—Ç —á–∞—Å—Ç—å —Ñ–∞–π–ª–∞ –∏ –∫–ª—é—á –¥–ª—è —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∏ —É —Å–µ–±—è, –∞ –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –¥–æ–±–∞–≤–∏—Ç —Ñ–∞–π–ª–∏–∫ technopark.enc. –ï–≥–æ –Ω–∞–¥–æ –Ω–µ –∑–∞–±—ã—Ç—å –∑–∞–ø—É—à–∏—Ç—å.

–ò—Ç–æ–≥–æ, —á—Ç–æ–±—ã –ø–æ–ª–æ–∂–∏—Ç—å —Ñ–∞–π–ª—ã –Ω–∞ —Å–µ—Ä–≤–µ—Ä:

```
language: node_js
node_js:
- '8'
script:
- eval "$(ssh-agent -s)"
- ssh-keyscan -H $SERVER_IP >> ~/.ssh/known_hosts
- chmod 600 $HOME/.ssh/technopark
- ssh-add $HOME/.ssh/technopark
- npm run build
- scp -r ./dist root@$SERVER_IP:/var/www
before_install:
- openssl aes-256-cbc -K $encrypted_cff8668a0280_key -iv $encrypted_cff8668a0280_iv
  -in technopark.enc -out $HOME/.ssh/technopark -d
```

–ü–æ—Å–ª–µ –≤—Å–µ—Ö –º–∞–Ω–∏–ø—É–ª—è—Ü–∏–π –º–æ–∂–Ω–æ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å nginx:

`yum install nginx` (Centos, Fedora, RHEL)

`apt-get install nginx` (Debian, Ubuntu, —á—Ç–æ—Ç–æ–µ—â—ë)

‚ö†Ô∏è –í–∞–∂–Ω–æ! –û—Ç–∫–ª—é—á–∏—Ç–µ SeLinux –∫–æ–º–∞–Ω–¥–æ–π `setenforce 0`, –∏–Ω–∞—á–µ –º–æ–∂–µ—Ç–µ –ø–æ–ª—É—á–∞—Ç—å –≤–µ—á–Ω—ã–µ 403 –æ—à–∏–±–∫–∏ (–∞–∫—Ç—É–∞–ª—å–Ω–æ –¥–ª—è centos)

–ù–∞—Å—Ç—Ä–æ–∏–º nginx –∫–æ–Ω—Ñ–∏–≥ (/etc/nginx/conf.d/default.conf)
```
server {
  listen 80;
  server_name jsdaddy.tech;

  location / {
    root /var/www;
  }
}
```

–ù—É –∏ –≤—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç. –ù–µ —Ö–≤–∞—Ç–∞–µ—Ç https. –ï–≥–æ –º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –±–µ—Å–ø–ª–∞—Ç–Ω–æ —Å –ø–æ–º–æ—â—å—é letsencrypt.
–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:
1. –ú—ã —Å—Ç–∞–≤–∏–º –Ω–∞ —Å–µ—Ä–≤–∞–∫ —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ certbot (–∏–ª–∏ –∑–∞–ø—É—Å–∫–∞–µ–º –≤ –¥–æ–∫–µ—Ä–µ)
2. –ó–∞–ø—É—Å–∫–∞–µ–º certbot –≤ –æ–¥–Ω–æ–º –∏–∑ —Ä–µ–∂–∏–º–æ–≤ (webroot –∏–ª–∏ standalone)

    2.1. –í —Ä–µ–∂–∏–º–µ webroot certbot –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Ñ–∞–π–ª–∏–∫ –∏ –∫–ª–∞–¥—ë—Ç –µ–≥–æ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é, –∫–æ—Ç–æ—Ä—É—é –º—ã —É–∫–∞–∑—ã–≤–∞–µ–º –∫–∞–∫ webroot. –≠—Ç–æ—Ç —Ñ–∞–π–ª –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ –ø—É—Ç–∏ `http://<–≤–∞—à_–¥–æ–º–µ–Ω>/.well-known/acme-challenge/<–∫–∞–∫–æ–π-—Ç–æ —Ñ–∞–π–ª>`. Certbot –ø–æ—Å–ª–µ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ñ–∞–π–ª–∞ –¥—ë—Ä–≥–∞–µ—Ç –≤–∞—à –µ–≥–æ –ø–æ –ø—É–±–ª–∏—á–Ω–æ–º—É –ø—É—Ç–∏, —Ç–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º –ø—Ä–æ–≤–µ—Ä—è–µ—Ç, —á—Ç–æ –≤—ã - —Ä–µ–∞–ª—å–Ω—ã–π –≤–ª–∞–¥–µ–ª–µ—Ü —Å–∞–π—Ç–∞ –∏ –≤—ã–ø–∏—Å—ã–≤–∞–µ—Ç —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç. –°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã –∫–ª–∞–¥—É—Ç—Å—è –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é `/etc/letsencrypt/live/–≤–∞—à–¥–æ–º–µ–Ω/fullchain.pem`

    Nginx –∫–æ–Ω—Ñ–∏–≥ –¥–æ –ø–æ–ª—É—á–µ–Ω–∏—è —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞:

    ```
    server {
      listen 80;
      server_name jsdaddy.tech;

      location / {
        root /var/www;
      }

      location /.well-known/acme-challenge/ {
        root /var/www/webroot;
      }
    }
    ```

    –ü–æ–ª—É—á–∞–µ–º —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç: `certbot certonly --webroot -w /var/www/webroot -d jsdaddy.tech`

    2.2. –í —Ä–µ–∂–∏–º–µ standalone –Ω–∞–º –Ω—É–∂–Ω–æ –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å nginx, –ø–æ—Ç–æ–º—É —á—Ç–æ certbot –ø–æ–¥–Ω–∏–º–µ—Ç —Å–≤–æ–π —Å–µ—Ä–≤–µ—Ä –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤–ª–∞–¥–µ–ª—å—Ü–∞ –Ω–∞ 80 –ø–æ—Ä—Ç—É: `certbot certonly --standalone -d jsdaddy.tech`

    –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —ç—Ç–æ—Ç —Å–ø–æ—Å–æ–± —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –Ω–µ –±–æ–∏—Ç–µ—Å—å –¥–∞—É–Ω—Ç–∞–π–º–∞ –≤–∞—à–µ–≥–æ —Å–µ—Ä–≤–∏—Å–∞.

    ‚ö†Ô∏è –£ letsencrypt –µ—Å—Ç—å –ª–∏–º–∏—Ç - 20 —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤ –Ω–∞ –¥–æ–º–µ–Ω –∑–∞ 3 —á–∞—Å–∞. –ù–µ –∑–∞–∏–≥—Ä–∞–π—Ç–µ—Å—å :)

–ü–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞ –º–æ–∂–Ω–æ —É–∂–µ –≤—Ä—É–±–∞—Ç—å –µ–≥–æ –¥–ª—è —Å–∞–π—Ç–∞ –∏ —Ä–µ–¥–∏—Ä–µ–∫—Ç–∏—Ç—å —Å http –≤–µ—Ä—Å–∏–∏.

```
    server {
      listen 80;
      server_name jsdaddy.tech;

      location / {
        return 301 https://jsdaddy.tech$request_uri;
      }

      location /.well-known/acme-challenge/ {
        root /var/www/webroot; # –æ—Å—Ç–∞–≤–∏–º —ç—Ç–æ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞
      }
    }


    server {
      listen 443 ssl http2;
      server_name jsdaddy.tech;

      ssl_certificate /etc/letsencrypt/live/jsdaddy.tech/fullchain.pem;
      ssl_certificate_key /etc/letsencrypt/live/jsdaddy.tech/privkey.pem;

      location / {
        root /var/www;
      }
    }
```


